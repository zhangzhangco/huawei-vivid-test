# HDR色调映射实验操作指南

本文面向算法研究人员与工程师，说明如何在本仓库上开展 Phoenix 曲线与 HDR 图像实验，并记录可复现的实验步骤。

## 1. 环境准备
- Python ≥ 3.8，建议创建独立虚拟环境：  
  ```bash
  python3 -m venv .venv
  source .venv/bin/activate  # Windows 使用 .venv\Scripts\activate
  ```
- 安装依赖：`pip install -r requirements.txt`。若需要开发工具，执行 `pip install -e .[dev]`。
- 可选 GPU 支持：`pip install -e .[gpu]` 并确保 CUDA 驱动可用。

## 2. 启动实验界面
- 终端执行 `python launch_gradio.py`，默认在 `http://localhost:7860` 打开完整界面。
- HuggingFace Spaces 部署请参考 `DEPLOYMENT_GUIDE.md`，本地/远程界面一致。

## 3. Phoenix 曲线实验
1. 在 “参数控制面板” 选择 **艺术模式**，通过 `p`、`a` 滑块探索曲线行为；曲线图右侧显示 Phoenix 曲线与恒等线。
2. 勾选 “启用样条曲线” 可加载局部调节，TH1/TH2/TH3 控制节点位置，TH_strength 控制混合强度。
3. 实验记录建议导出 `docs/experiments` 目录的 CSV/LUT：点击 “导出数据” 保存 JSON（含参数）后，使用 `src/core/export_manager.py` 中 `ExportManager` 生成 `.cube` 或 `.csv`（示例见 `examples/export_demo.py`）。

## 4. HDR 图像实验
1. “图像处理” 区域上传 `.hdr/.exr/.png/.tiff` 等文件；图像信息窗口会显示检测到的格式与统计。
2. 调整参数后点击 “处理图像”。界面会显示映射后的图像与统计数据；失真/对比度数字同步更新。
3. 若需批量实验，可参考 `examples/image_processing_demo.py`，在脚本中调用 `ImageProcessor` 与 `ExportManager` 批处理图像并收集指标。

## 5. 时域平滑实验
1. 在参数面板设置窗口大小 `M`(5-15) 与平滑强度 `λ`。
2. 连续处理多张图像或循环更新参数后，查看 “时域平滑统计” 卡片：帧数、方差降低百分比等指标会显示在界面右侧。
3. 若需使用原始 API，可调用 `TemporalSmoothingProcessor`（详见 `examples/temporal_smoothing_demo.py`）模拟帧序列并生成统计报告。

## 6. 数据导出与诊断
- 在界面点击 “导出数据” 下载当前参数与曲线 JSON。
- 若需要完整诊断包（含 `.cube`、`.csv`、状态文件），可在脚本中使用 `ExportManager.create_diagnostic_package()`，示例见 `examples/export_demo.py`。
- 会话与时域状态存储在 `.kiro_state/` 下，使用 “保存状态/加载状态” 按钮可备份实验参数。

## 7. 实验记录建议
- 建议将每次实验的参数、图像输入、导出文件、质量指标记录在 `experiments/` 自建目录。
- 运行 `python -m pytest` 验证核心功能是否回归（某些环境需先确保 `python` 命令可用）。
- 对关键实验，使用 `tests/run_validation_tests.py --test-type all --report-format both` 生成 Markdown/JSON 报告，便于成果归档。

如需了解详细 API，可查阅 `docs/API_DOCUMENTATION.md`；界面操作说明参见 `docs/USER_MANUAL.md`。
